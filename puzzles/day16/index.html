<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous">
<script src="https://plausible.scala-lang.org/js/script.js" defer="defer" async data-domain="scalacenter.github.io"></script><title data-react-helmet="true">Day 16: Packet Decoder | Scala Center Advent of Code</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://scalacenter.github.io//scala-advent-of-code/puzzles/day16"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Day 16: Packet Decoder | Scala Center Advent of Code"><meta data-react-helmet="true" name="description" content="by @tgodzik"><meta data-react-helmet="true" property="og:description" content="by @tgodzik"><link data-react-helmet="true" rel="shortcut icon" href="/scala-advent-of-code/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day16"><link data-react-helmet="true" rel="alternate" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day16" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day16" hreflang="x-default"><link rel="stylesheet" href="/scala-advent-of-code/assets/css/styles.16a73e1b.css">
<link rel="preload" href="/scala-advent-of-code/assets/js/runtime~main.a06e5205.js" as="script">
<link rel="preload" href="/scala-advent-of-code/assets/js/main.b7c75463.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/scala-advent-of-code/"><div class="navbar__logo"><img src="/scala-advent-of-code/img/scala-tree.png" alt="Scala Center" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/scala-advent-of-code/img/scala-tree.png" alt="Scala Center" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Scala Advent of Code</b></a><a class="navbar__item navbar__link navbar__link--active" href="/scala-advent-of-code/introduction">Introduction</a><a class="navbar__item navbar__link navbar__link--active" href="/scala-advent-of-code/setup">Setup</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Puzzles</a><ul class="dropdown__menu"><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day1">Day 1</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day2">Day 2</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day3">Day 3</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day4">Day 4</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day5">Day 5</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day6">Day 6</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day7">Day 7</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day8">Day 8</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day9">Day 9</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day10">Day 10</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day11">Day 11</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day12">Day 12</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day13">Day 13</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day14">Day 14</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day15">Day 15</a></li><li><a aria-current="page" class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day16">Day 16</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day17">Day 17</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day20">Day 20</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day21">Day 21</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day22">Day 21</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day23">Day 21</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day24">Day 21</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day25">Day 21</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scalacenter/scala-advent-of-code" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/scala-advent-of-code/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/scala-advent-of-code/setup">Setup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Puzzles</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day1">Day 1: Sonar Sweep</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day2">Day 2: Dive!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day3">Day 3: Binary Diagnostic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day4">Day 4: Giant Squid</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day5">Day 5: Hydrothermal Venture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day6">Day 6: Lanternfish</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day7">Day 7: The Treachery of Whales</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day8">Day 8: Seven Segment Search</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day9">Day 9: Smoke Basin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day10">Day 10: Syntax Scoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day11">Day 11: Dumbo Octopus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day12">Day 12: Passage Pathing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day13">Day 13: Transparent Origami</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day14">Day 14: Extended Polymerization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day15">Day 15: Chiton</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/scala-advent-of-code/puzzles/day16">Day 16: Packet Decoder</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day17">Day 17: Trick Shot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day18">Day 18: Snailfish</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day19">Day 19: Beacon Scanner</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day20">Day 20: Trench Map</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day21">Day 21: Dirac Dice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day22">Day 22: Reactor Reboot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day23">Day 23: Amphipod</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day24">Day 24: Arithmetic Logic Unit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day25">Day 25: Sea Cucumber</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Day 16: Packet Decoder</h1></header><p>by <a href="https://github.com/tgodzik" target="_blank" rel="noopener noreferrer">@tgodzik</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="puzzle-description">Puzzle description<a aria-hidden="true" class="hash-link" href="#puzzle-description" title="Direct link to heading">â€‹</a></h2><p><a href="https://adventofcode.com/2021/day/16" target="_blank" rel="noopener noreferrer">https://adventofcode.com/2021/day/16</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="part1-youve-got-mail">Part1: You&#x27;ve got mail!<a aria-hidden="true" class="hash-link" href="#part1-youve-got-mail" title="Direct link to heading">â€‹</a></h2><p>It seems that we can split our problem into two parts. First, we need to parse
the example into structures that we can later use to calculate our results.</p><p>Let&#x27;s start with defining the data structures to use:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">enum Packet(version: Int, typeId: Int):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Literal(version: Int, value: Long) extends Packet(version, 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Operator(version: Int, typeId: Int, exprs: List[Packet]) extends Packet(version, typeId)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>Packet.Literal</code> will represent simple literal packets, that contain only a
value. We are using Long, just in case of large integer numbers based on the
experience with previous Advent of Code puzzles.</p><p><code>Packet.Operator</code> will represent all the other operators that can contain other
packets.</p><p>Now we need to map our input to these structures.</p><p>Let&#x27;s start by mapping the hexadecimal input to a list of chars that we can
analyze easier when checking for packets:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val hexadecimalMapping =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;0&#x27; -&gt; &quot;0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;1&#x27; -&gt; &quot;0001&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;2&#x27; -&gt; &quot;0010&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;3&#x27; -&gt; &quot;0011&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;4&#x27; -&gt; &quot;0100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;5&#x27; -&gt; &quot;0101&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;6&#x27; -&gt; &quot;0110&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;7&#x27; -&gt; &quot;0111&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;8&#x27; -&gt; &quot;1000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;9&#x27; -&gt; &quot;1001&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;A&#x27; -&gt; &quot;1010&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;B&#x27; -&gt; &quot;1011&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;C&#x27; -&gt; &quot;1100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;D&#x27; -&gt; &quot;1101&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;E&#x27; -&gt; &quot;1110&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;F&#x27; -&gt; &quot;1111&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def parse(input: String) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val byteInput = input.toList.flatMap(hex =&gt; hexadecimalMapping(hex).toCharArray)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This will produce the input that we have seen in the puzzle description:</p><p><code>110100101111111000101000</code></p><p>Since we&#x27;ve got that we can start defining our function for decoding packets. We
first define parsing of elements common to all the packets, which is the version
and the type ID. Based on the type id we can see how we need to parse the rest
of the data.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type BinaryData = List[Char]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// helper function to read binary data 01101 to decimal 13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def toInt(chars: BinaryData): Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Integer.parseInt(chars.mkString, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// helper function to read binary data 01101 to decimal 13, but in a Long format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def toLong(chars: BinaryData): Long =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  java.lang.Long.parseLong(chars.mkString, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readLiteralBody(input: BinaryData): (Long, BinaryData) = ???</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readOperatorBody(input: BinaryData): (List[Packet], BinaryData) = ???</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def decodePacket(packet: BinaryData): (Packet, BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (versionBits, rest) = packet.splitAt(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val version = toInt(versionBits)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (typeBits, body) = rest.splitAt(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val tpe = toInt(typeBits)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tpe match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case 4 =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (value, remaining) = readLiteralBody(body, Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (Packet.Literal(version, value), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case otherTpe =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (values, remaining) = readOperatorBody(body)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (Packet.Operator(version, otherTpe, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end decodePacket</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We use the function <code>splitAt</code>, which gives us the ability to split the input
into the part that we need, for example 3 bits for version, and the rest of the
packet data. This way we can read the version and typeId, pattern match on the
latter and use proper logic for reading in each case. We can then create our new
structures. We also defined a helper type <code>BinaryData</code>, since we will be using
it throughout the puzzle. What remains is defining <code>readLiteralBody</code> and
<code>readOperatorBody</code>. You might notice that we return additional <code>BinaryData</code> from
each function. This is because we will be later able to use it to analyze the
output further in a recursive manner, but we&#x27;ll get back to it.</p><p>Let&#x27;s start with the first undefined function <code>readLiteralBody</code>. In the
description we read that the body of the literal consists of segments of 5 bits,
where the last segment will start with 0 and all the others with 1. The
remaining 4 bits can be used to construct a number. We can create a recursive
function that will handle it perfectly!</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readLiteralBody(tail: BinaryData, numAcc: BinaryData): (Long, BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (num, rest) = tail.splitAt(5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if num(0) == &#x27;1&#x27; then readLiteralBody(rest, numAcc.appendedAll(num.drop(1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val bits = numAcc.appendedAll(num.drop(1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (toLong(bits), rest)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end readLiteralBody</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In each step we read 5 bits from the input and check if we should finish. If the
first bit is <code>0</code> then we know that we can append the last 5 bits and return the
current result. In case the first bit is <code>1</code>, we need to repeat the step once
more on the remaining bits.</p><p>The harder part will be defining <code>readOperatorBody</code> since we know that operator
packets can contain other packets and those packets can also be operators! This
means we will need to apply a recursive approach:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def readOperatorBody(current: BinaryData): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (lenId, rest) = current.splitAt(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def readMaxBits(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      current: BinaryData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      remaining: Int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acc: List[Packet]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if remaining == 0 then (acc, current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (newExpr, rest) = decodePacket(current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxBits(rest, remaining - (current.size - rest.size), acc :+ newExpr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def readMaxPackets(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      current: BinaryData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      remaining: Int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acc: List[Packet]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if remaining == 0 then (acc, current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (newExpr, rest) = decodePacket(current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxPackets(rest, remaining - 1, acc :+ newExpr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // read based on length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if lenId(0) == &#x27;0&#x27; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val (size, packets) = rest.splitAt(15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    readMaxBits(packets, toInt(size), Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // read based on number of packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val (size, packets) = rest.splitAt(11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    readMaxPackets(packets, toInt(size), Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end readOperatorBody</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the above function we first check the first bit of the operator body, which
tells us how we should check the rest of the body.</p><ul><li><p>if the bit is <code>0</code> it means that the next 15 bits can be turned into a number,
that will define how many of the further bits are the subpackets of the
operator.</p></li><li><p>if the bit is <code>1</code> it means that the next 11 bits can be turned into a number,
that will define how many subpackets should belong to the operator.</p></li></ul><p>We defined two helper recursive functions <code>readMaxBits</code> and <code>readMaxPackets</code>
which will check if the stopping condition (either max bits read or max packets
read) is achieved or read a new packet using recursively the <code>decodePacket</code>
function otherwise. At the end they will both return a list of packets, that we
can later use to put into the operator packet, and the remaining input that we
might need to check for more packets.</p><p>This should already allow us to create a full structure and what remains is
adding a function that can add up all the versions. We can add that function to
the <code>Packet</code> enum and sum it all recursively.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  def versionSum: Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Literal(version, _)     =&gt; version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Operator(version, exprs, _) =&gt; version + exprs.map(_.versionSum).sum</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>That&#x27;s it! We should be able to solve the part 1.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="full-solution">Full solution<a aria-hidden="true" class="hash-link" href="#full-solution" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package day16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scala.util.Using</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scala.io.Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scala.annotation.tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@main def part1(): Unit =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  println(s&quot;The solution is ${part1(readInput())}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readInput(): String =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Using.resource(Source.fromFile(&quot;input/day16&quot;))(_.mkString)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val hexadecimalMapping =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;0&#x27; -&gt; &quot;0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;1&#x27; -&gt; &quot;0001&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;2&#x27; -&gt; &quot;0010&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;3&#x27; -&gt; &quot;0011&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;4&#x27; -&gt; &quot;0100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;5&#x27; -&gt; &quot;0101&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;6&#x27; -&gt; &quot;0110&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;7&#x27; -&gt; &quot;0111&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;8&#x27; -&gt; &quot;1000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;9&#x27; -&gt; &quot;1001&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;A&#x27; -&gt; &quot;1010&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;B&#x27; -&gt; &quot;1011&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;C&#x27; -&gt; &quot;1100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;D&#x27; -&gt; &quot;1101&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;E&#x27; -&gt; &quot;1110&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;F&#x27; -&gt; &quot;1111&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum Packet(version: Int, typeId: Int):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Literal(version: Int, value: Long) extends Packet(version, 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Operator(version: Int, typeId: Int, exprs: List[Packet]) extends Packet(version, typeId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def versionSum: Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Literal(version, _)         =&gt; version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Operator(version, _, exprs) =&gt; version + exprs.map(_.versionSum).sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type BinaryData = List[Char]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// helper function to read binary data 01101 to decimal 13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def toInt(chars: BinaryData): Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Integer.parseInt(chars.mkString, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// helper function to read binary data 01101 to decimal 13, but in a Long format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def toLong(chars: BinaryData): Long =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  java.lang.Long.parseLong(chars.mkString, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readLiteralBody(tail: BinaryData, numAcc: BinaryData): (Long, BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (num, rest) = tail.splitAt(5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if num(0) == &#x27;1&#x27; then readLiteralBody(rest, numAcc.appendedAll(num.drop(1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val bits = numAcc.appendedAll(num.drop(1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (toLong(bits), rest)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end readLiteralBody</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readOperatorBody(current: BinaryData): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (lenId, rest) = current.splitAt(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def readMaxBits(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      current: BinaryData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      remaining: Int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acc: List[Packet]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if remaining == 0 then (acc, current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (newExpr, rest) = decodePacket(current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxBits(rest, remaining - (current.size - rest.size), acc :+ newExpr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def readMaxPackets(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      current: BinaryData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      remaining: Int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acc: List[Packet]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if remaining == 0 then (acc, current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (newExpr, rest) = decodePacket(current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxPackets(rest, remaining - 1, acc :+ newExpr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lenId match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // read based on length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case List(&#x27;0&#x27;) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (size, packets) = rest.splitAt(15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxBits(packets, toInt(size), Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // read based on number of packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case _ =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (size, packets) = rest.splitAt(11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxPackets(packets, toInt(size), Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end readOperatorBody</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def decodePacket(input: BinaryData): (Packet, BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (versionBits, rest) = input.splitAt(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val version = toInt(versionBits)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (typeBits, body) = rest.splitAt(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val tpe = toInt(typeBits)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tpe match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case 4 =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (value, remaining) = readLiteralBody(body, Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (Packet.Literal(version, value), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case otherTpe =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (values, remaining) = readOperatorBody(body)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (Packet.Operator(version, otherTpe, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end decodePacket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def parse(input: String) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val number = input.toList.flatMap(hex =&gt; hexadecimalMapping(hex).toCharArray)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (operator, _) = decodePacket(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def part1(input: String) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val packet = parse(input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  packet.versionSum</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div id="day16-part1"></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="part-2-the-elven-calculus">Part 2: The Elven calculus<a aria-hidden="true" class="hash-link" href="#part-2-the-elven-calculus" title="Direct link to heading">â€‹</a></h2><p>Turns out that operator packets are actual mathematical operators and we can use
the type ID to distinguish them!</p><p>We need to improve our structure to better show the different mathematical
operators. For that we define additional enum cases instead of a single
<code>Operator</code> case.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">enum Packet(version: Int, typeId: Int):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Sum(version: Int, exprs: List[Packet]) extends Packet(version, 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Product(version: Int, exprs: List[Packet]) extends Packet(version, 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Minimum(version: Int, exprs: List[Packet]) extends Packet(version, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Maximum(version: Int, exprs: List[Packet]) extends Packet(version, 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Literal(version: Int, literalValue: Long) extends Packet(version, 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case GreaterThan(version: Int, lhs: Packet, rhs: Packet) extends Packet(version, 5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case LesserThan(version: Int, lhs: Packet, rhs: Packet) extends Packet(version, 6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Equals(version: Int, lhs: Packet, rhs: Packet) extends Packet(version, 7)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We will also need to modify the way we create these operators:</p><p>So instead of</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">      val (values, remaining) = readOperatorBody(body)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (Packet.Operator(version, otherTpe, values), remaining)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>we will need to write:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">     val (values, remaining) = readOperatorBody(body)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      otherTpe match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 0 =&gt; (Packet.Sum(version, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 1 =&gt; (Packet.Product(version, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 2 =&gt; (Packet.Minimum(version, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 3 =&gt; (Packet.Maximum(version, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 5 =&gt; (Packet.GreaterThan(version, values(0), values(1)), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 6 =&gt; (Packet.LesserThan(version, values(0), values(1)), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 7 =&gt; (Packet.Equals(version, values(0), values(1)), remaining)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This makes our structure accurately show the mathematical computation that is
constructed from the packets. The last remaining step is to create a function
that will calculate the equation. We can do it similarly to the <code>versionsSum</code>
function in the previous part:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  def value: Long =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Sum(version, exprs)            =&gt; exprs.map(_.value).sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Product(version, exprs)        =&gt; exprs.map(_.value).reduce(_ * _)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Minimum(version, exprs)        =&gt; exprs.map(_.value).min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Maximum(version, exprs)        =&gt; exprs.map(_.value).max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Literal(version, value)        =&gt; value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case GreaterThan(version, lhs, rhs) =&gt; if lhs.value &gt; rhs.value then 1 else 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case LesserThan(version, lhs, rhs)  =&gt; if lhs.value &lt; rhs.value then 1 else 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Equals(version, lhs, rhs)      =&gt; if lhs.value == rhs.value then 1 else 0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="full-solution-1">Full solution<a aria-hidden="true" class="hash-link" href="#full-solution-1" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package day16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scala.util.Using</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scala.io.Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scala.annotation.tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@main def part1(): Unit =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  println(s&quot;The solution is ${part1(readInput())}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@main def part2(): Unit =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  println(s&quot;The solution is ${part2(readInput())}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readInput(): String =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Using.resource(Source.fromFile(&quot;input/day16&quot;))(_.mkString)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val hexadecimalMapping =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;0&#x27; -&gt; &quot;0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;1&#x27; -&gt; &quot;0001&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;2&#x27; -&gt; &quot;0010&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;3&#x27; -&gt; &quot;0011&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;4&#x27; -&gt; &quot;0100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;5&#x27; -&gt; &quot;0101&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;6&#x27; -&gt; &quot;0110&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;7&#x27; -&gt; &quot;0111&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;8&#x27; -&gt; &quot;1000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;9&#x27; -&gt; &quot;1001&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;A&#x27; -&gt; &quot;1010&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;B&#x27; -&gt; &quot;1011&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;C&#x27; -&gt; &quot;1100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;D&#x27; -&gt; &quot;1101&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;E&#x27; -&gt; &quot;1110&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;F&#x27; -&gt; &quot;1111&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Structures for all possible operators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum Packet(version: Int, typeId: Int):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Sum(version: Int, exprs: List[Packet]) extends Packet(version, 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Product(version: Int, exprs: List[Packet]) extends Packet(version, 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Minimum(version: Int, exprs: List[Packet]) extends Packet(version, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Maximum(version: Int, exprs: List[Packet]) extends Packet(version, 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Literal(version: Int, literalValue: Long) extends Packet(version, 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case GreaterThan(version: Int, lhs: Packet, rhs: Packet) extends Packet(version, 5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case LesserThan(version: Int, lhs: Packet, rhs: Packet) extends Packet(version, 6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case Equals(version: Int, lhs: Packet, rhs: Packet) extends Packet(version, 7)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def versionSum: Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Sum(version, exprs)            =&gt; version + exprs.map(_.versionSum).sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Product(version, exprs)        =&gt; version + exprs.map(_.versionSum).sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Minimum(version, exprs)        =&gt; version + exprs.map(_.versionSum).sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Maximum(version, exprs)        =&gt; version + exprs.map(_.versionSum).sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Literal(version, value)        =&gt; version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case GreaterThan(version, lhs, rhs) =&gt; version + lhs.versionSum + rhs.versionSum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case LesserThan(version, lhs, rhs)  =&gt; version + lhs.versionSum + rhs.versionSum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Equals(version, lhs, rhs)      =&gt; version + lhs.versionSum + rhs.versionSum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def value: Long =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Sum(version, exprs)            =&gt; exprs.map(_.value).sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Product(version, exprs)        =&gt; exprs.map(_.value).reduce(_ * _)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Minimum(version, exprs)        =&gt; exprs.map(_.value).min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Maximum(version, exprs)        =&gt; exprs.map(_.value).max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Literal(version, value)        =&gt; value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case GreaterThan(version, lhs, rhs) =&gt; if lhs.value &gt; rhs.value then 1 else 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case LesserThan(version, lhs, rhs)  =&gt; if lhs.value &lt; rhs.value then 1 else 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case Equals(version, lhs, rhs)      =&gt; if lhs.value == rhs.value then 1 else 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end Packet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type BinaryData = List[Char]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inline def toInt(chars: BinaryData): Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Integer.parseInt(chars.mkString, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inline def toLong(chars: BinaryData): Long =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  java.lang.Long.parseLong(chars.mkString, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readLiteralBody(tail: BinaryData, numAcc: BinaryData): (Long, BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (num, rest) = tail.splitAt(5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if num(0) == &#x27;1&#x27; then readLiteralBody(rest, numAcc.appendedAll(num.drop(1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val bits = numAcc.appendedAll(num.drop(1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (toLong(bits), rest)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end readLiteralBody</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def readOperatorBody(current: BinaryData): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (lenId, rest) = current.splitAt(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def readMaxBits(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      current: BinaryData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      remaining: Int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acc: List[Packet]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if remaining == 0 then (acc, current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (newExpr, rest) = decodePacket(current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxBits(rest, remaining - (current.size - rest.size), acc :+ newExpr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @tailrec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def readMaxPackets(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      current: BinaryData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      remaining: Int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acc: List[Packet]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): (List[Packet], BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if remaining == 0 then (acc, current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (newExpr, rest) = decodePacket(current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxPackets(rest, remaining - 1, acc :+ newExpr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lenId match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // read based on length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case List(&#x27;0&#x27;) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (size, packets) = rest.splitAt(15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxBits(packets, toInt(size), Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // read based on number of packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case _ =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (size, packets) = rest.splitAt(11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      readMaxPackets(packets, toInt(size), Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end readOperatorBody</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def decodePacket(packet: BinaryData): (Packet, BinaryData) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (versionBits, rest) = packet.splitAt(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val version = toInt(versionBits)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (typeBits, body) = rest.splitAt(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val tpe = toInt(typeBits)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tpe match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case 4 =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (value, remaining) = readLiteralBody(body, Nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (Packet.Literal(version, value), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case otherTpe =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (values, remaining) = readOperatorBody(body)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      otherTpe match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 0 =&gt; (Packet.Sum(version, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 1 =&gt; (Packet.Product(version, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 2 =&gt; (Packet.Minimum(version, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 3 =&gt; (Packet.Maximum(version, values), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 5 =&gt; (Packet.GreaterThan(version, values(0), values(1)), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 6 =&gt; (Packet.LesserThan(version, values(0), values(1)), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case 7 =&gt; (Packet.Equals(version, values(0), values(1)), remaining)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end decodePacket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def parse(input: String) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val number = input.toList.flatMap(hex =&gt; hexadecimalMapping(hex).toCharArray)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (operator, _) = decodePacket(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def part1(input: String) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val packet = parse(input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  packet.versionSum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def part2(input: String) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val packet = parse(input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  packet.value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end part2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You might have noticed that we had to slightly modify the <code>versionsSum</code> function
to work with our new structure.</p><div id="day16-part2"></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="solutions-from-the-community">Solutions from the community<a aria-hidden="true" class="hash-link" href="#solutions-from-the-community" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://github.com/Jannyboy11/AdventOfCode2021/blob/main/src/main/scala/day16/Day16.scala" target="_blank" rel="noopener noreferrer">Solution</a> of <a href="https://twitter.com/JanBoerman95" target="_blank" rel="noopener noreferrer">Jan Boerman</a>.</li><li><a href="https://github.com/misja-alma/aoc2021/blob/master/src/main/scala/aoc2021/Day16.scala" target="_blank" rel="noopener noreferrer">Solution</a> of <a href="https://github.com/misja-alma" target="_blank" rel="noopener noreferrer">Misja Alma</a>.</li></ul><p>Share your solution to the Scala community by editing this page.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/scalacenter/scala-advent-of-code/edit/website/docs/puzzles/day16.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/scala-advent-of-code/puzzles/day15"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Day 15: Chiton</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/scala-advent-of-code/puzzles/day17"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Day 17: Trick Shot<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#puzzle-description" class="table-of-contents__link toc-highlight">Puzzle description</a></li><li><a href="#part1-youve-got-mail" class="table-of-contents__link toc-highlight">Part1: You&#39;ve got mail!</a><ul><li><a href="#full-solution" class="table-of-contents__link toc-highlight">Full solution</a></li></ul></li><li><a href="#part-2-the-elven-calculus" class="table-of-contents__link toc-highlight">Part 2: The Elven calculus</a><ul><li><a href="#full-solution-1" class="table-of-contents__link toc-highlight">Full solution</a></li></ul></li><li><a href="#solutions-from-the-community" class="table-of-contents__link toc-highlight">Solutions from the community</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/introduction">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/setup">Setup</a></li><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/puzzles/day1">Puzzles</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/channels/632150470000902164/913451015246868530" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/scala_lang" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://scala.epfl.ch/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scala Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/scalacenter" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Scala Center, Built with Docusaurus.</div></div></div></footer></div>
<script src="/scala-advent-of-code/assets/js/runtime~main.a06e5205.js"></script>
<script src="/scala-advent-of-code/assets/js/main.b7c75463.js"></script>
</body>
</html>