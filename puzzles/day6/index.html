<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<script src="https://plausible.scala-lang.org/js/plausible.js" defer="defer" async data-domain="scalacenter.github.io"></script><title data-react-helmet="true">Day 6: Lanternfish | Scala Center Advent of Code</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://scalacenter.github.io//scala-advent-of-code/puzzles/day6"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Day 6: Lanternfish | Scala Center Advent of Code"><meta data-react-helmet="true" name="description" content="by @julienrf"><meta data-react-helmet="true" property="og:description" content="by @julienrf"><link data-react-helmet="true" rel="shortcut icon" href="/scala-advent-of-code/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day6"><link data-react-helmet="true" rel="alternate" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day6" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day6" hreflang="x-default"><link rel="stylesheet" href="/scala-advent-of-code/assets/css/styles.16a73e1b.css">
<link rel="preload" href="/scala-advent-of-code/assets/js/runtime~main.c7f5ced4.js" as="script">
<link rel="preload" href="/scala-advent-of-code/assets/js/main.de35b7e5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/scala-advent-of-code/"><div class="navbar__logo"><img src="/scala-advent-of-code/img/scala-tree.png" alt="Scala Center" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/scala-advent-of-code/img/scala-tree.png" alt="Scala Center" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Scala Advent of Code</b></a><a class="navbar__item navbar__link navbar__link--active" href="/scala-advent-of-code/introduction">Introduction</a><a class="navbar__item navbar__link navbar__link--active" href="/scala-advent-of-code/setup">Setup</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Puzzles</a><ul class="dropdown__menu"><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day1">Day 1</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day2">Day 2</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day3">Day 3</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day4">Day 4</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day5">Day 5</a></li><li><a aria-current="page" class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day6">Day 6</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day7">Day 7</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day8">Day 8</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day9">Day 9</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day10">Day 10</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day11">Day 11</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day12">Day 12</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scalacenter/scala-advent-of-code" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/scala-advent-of-code/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/scala-advent-of-code/setup">Setup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Puzzles</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day1">Day 1: Sonar Sweep</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day2">Day 2: Dive!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day3">Day 3: Binary Diagnostic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day4">Day 4: Giant Squid</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day5">Day 5: Hydrothermal Venture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/scala-advent-of-code/puzzles/day6">Day 6: Lanternfish</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day7">Day 7: The Treachery of Whales</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day8">Day 8: Seven Segment Search</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day9">Day 9: Smoke Basin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day10">Day 10: Syntax Scoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day11">Day 11</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day12">Day 12</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Day 6: Lanternfish</h1></header><p>by <a href="https://github.com/julienrf" target="_blank" rel="noopener noreferrer">@julienrf</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="puzzle-description">Puzzle description<a aria-hidden="true" class="hash-link" href="#puzzle-description" title="Direct link to heading">​</a></h2><p><a href="https://adventofcode.com/2021/day/6" target="_blank" rel="noopener noreferrer">https://adventofcode.com/2021/day/6</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="solution-of-part-1">Solution of Part 1<a aria-hidden="true" class="hash-link" href="#solution-of-part-1" title="Direct link to heading">​</a></h2><p>For part 1, I implemented a &quot;naive&quot; solution by essentially translating the
problem statement into Scala.</p><p>For instance, the problem statement contains:</p><blockquote><p>You can model each fish as a single number that represents the number of days
until it creates a new lanternfish.</p></blockquote><p>So, my fish model is a case class with exactly one field containing
the number of days until that fish creates a new fish:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">case class Fish(timer: Int)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, we were asked to compute how a population of fish evolves after one
day passes:</p><blockquote><p>Each day, a 0 becomes a 6 and adds a new 8 to the end of the list, while each
other number decreases by 1</p></blockquote><p>So, I wrote a method <code>tick</code>, which takes as a parameter a population of fish,
and returns the state of the population the next day:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def tick(population: Seq[Fish]): Seq[Fish] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  population.flatMap { fish =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // &quot;Each day, a `0` becomes a `6` and adds a new `8` to the end of the list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if fish.timer == 0 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Seq(Fish(6), Fish(8))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // &quot;while each other number decreases by 1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Seq(Fish(fish.timer - 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We look at the <code>timer</code> value of every fish, and we apply the rule given in the
problem statement to compute how many fish (one or two) will result from that
fish, the next day.</p><p>Finally, we were given an initial population of fish, and we had to compute the
number of fish after 80 days. I wrote a method <code>simulate</code> to achieve this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def simulate(days: Int, initialPopulation: Seq[Fish]): Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (1 to days)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .foldLeft(initialPopulation)((population, _) =&gt; tick(population))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .size</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>First, we create a collection of iteration indices (<code>1 to days</code>). Then, we
iterate over the indices by applying the method <code>foldLeft</code>. The iteration
function discards the index value and calls the method <code>tick</code> to compute the
next population based on the current population (starting with the
<code>initialPopulation</code>, which is provided in the challenge).</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="final-code-for-part-1">Final code for Part 1<a aria-hidden="true" class="hash-link" href="#final-code-for-part-1" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// &quot;Find a way to simulate lanternfish. How many lanternfish would there be after 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// days?&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def part1(input: String): Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  simulate(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    days = 80,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initialPopulation = Fish.parseSeveral(input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// &quot;You can model each fish as a single number that represents the number of days</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// until it creates a new lanternfish.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case class Fish(timer: Int)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Fish:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // &quot;Suppose you were given the following list:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 3,4,3,1,2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // This list means that the first fish has an internal timer of 3, the second fish</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // has an internal timer of 4, and so on until the fifth fish, which has an</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // internal timer of 2.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def parseSeveral(input: String): Seq[Fish] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for timerString &lt;- input.trim.split(&quot;,&quot;).toIndexedSeq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yield Fish(timerString.toInt.ensuring(_ &gt;= 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Simulate the evolution of the population and return the number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * of fishes at the end of the simulation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param days Number of days to simulate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param initialPopulation Initial population</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def simulate(days: Int, initialPopulation: Seq[Fish]): Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (1 to days)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .foldLeft(initialPopulation)((population, _) =&gt; tick(population))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Compute a new population after one day passes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param population Current population</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @return New population</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def tick(population: Seq[Fish]): Seq[Fish] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  population.flatMap { fish =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // &quot;Each day, a `0` becomes a `6` and adds a new `8` to the end of the list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if fish.timer == 0 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Seq(Fish(6), Fish(8))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // &quot;while each other number decreases by 1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Seq(Fish(fish.timer - 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div id="day6-part1"></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="first-attempt-for-part-2">First attempt for Part 2<a aria-hidden="true" class="hash-link" href="#first-attempt-for-part-2" title="Direct link to heading">​</a></h2><p>The challenge for the part 2 does not seem complex at the first sight:</p><blockquote><p>How many lanternfish would there be after 256 days?</p></blockquote><p>Let’s just run our simulation for 256 days instead of 80 days, and we are good!</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def part2(input: String): Int =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  simulate(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    days = 256,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initialPopulation = Fish.parseSeveral(input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Unfortunately, after running for a few minutes, it crashed with the
following error:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.reflect.ManifestFactory$AnyManifest.newArray(Manifest.scala:328)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.reflect.ManifestFactory$AnyManifest.newArray(Manifest.scala:327)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.IterableOnceOps.toArray(IterableOnce.scala:1278)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.IterableOnceOps.toArray$(IterableOnce.scala:1276)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.AbstractIterable.toArray(Iterable.scala:919)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.immutable.ArraySeq$.$anonfun$newBuilder$1(ArraySeq.scala:278)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.immutable.ArraySeq$$$Lambda$28/0x000000084010c040.apply(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.mutable.Builder$$anon$1.result(Builder.scala:83)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.StrictOptimizedIterableOps.flatMap(StrictOptimizedIterableOps.scala:119)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.StrictOptimizedIterableOps.flatMap$(StrictOptimizedIterableOps.scala:104)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at scala.collection.immutable.ArraySeq.flatMap(ArraySeq.scala:35)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at day6$package$.tick(day6.scala:39)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at day6$package$.simulate$$anonfun$1(day6.scala:29)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at day6$package$.simulate$$anonfun$adapted$1(day6.scala:29)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Oops.</p><p>What happens is that there are too many fish, and computing the collection
of timer values for every one of them eats all the memory of my computer!</p><p>In such a situation, we need to come up with a different model. We need to
find a model that can compute the same result, but by using less information.</p><p>If we look at the computation, there are lots of redundant parts. For every
fish whose timer value is initially the same, the sequence of computations
will also be the same to find out how many fish will be created by it and its
descendants, within 256 days.</p><p>So, instead of modeling the problem with a collection of fish, what we can do
is to model it as a <code>Map</code> that associates every possible timer value
(between 0 and 8) to the number of fish with this timer value:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val population: Map[Int, BigInt] = ???</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We associate every timer value (possible values are between <code>0</code> to <code>8</code>,
which we model with an <code>Int</code>) to a number of fish with this timer value.
Since our previous attempt caused a memory issue, I anticipated that the
number of fish can grow very large, and may exceed the capacity of the type
<code>Int</code> (about 2 billions). We could use the type <code>Long</code> instead, which
supports even larger numbers, but I preferred to fix the issue once and for
all by using the type <code>BigInt</code>, which models numbers of arbitrary size.</p><p>Let’s look at an example of population of fish with this model. In the
problem statement, the following population is used as an example. It is
described by the “timer” value of every fish:</p><blockquote><p>3,4,3,1,2</p></blockquote><p>This population has 5 fish. Two of them have a timer value of <code>3</code>, and the
others have timer values of <code>1</code>, <code>2</code>, and <code>4</code>, respectively. Here is how we
model it with our <code>Map</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val population: Map[Int, BigInt] = Map(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1 -&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2 -&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3 -&gt; 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4 -&gt; 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The input data is provided in the &quot;comma-separated timer values&quot;
format. How do we compute a <code>Map</code> from that?</p><p>What I did is to parse the timer values from the input data, and then
compute a <code>Map</code> associating each timer value to its number of fish
(basically, a map of occurrences) by using the method <code>groupMapReduce</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val initialPopulation: Map[Int, BigInt] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  input.split(&quot;,&quot;).groupMapReduce(_.toInt)(_ =&gt; BigInt(1))(_ + _)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The first argument of <code>groupMapReduce</code> is the &quot;partition function&quot;. It defines
how the fish should be grouped together. Here, they are grouped by using
their timer value.</p><p>The second argument defines how we want to model a fish, within each group.
Here, we want to count them, so I used the constant value <code>BigInt(1)</code> for
every fish.</p><p>Last, the third argument defines how to combine the fish within a group.
Here, we just add the occurrences together.</p><p>Next, how do we compute the map of occurrences of the next day, given a current
map of occurrences? We create a new map of occurrences where we associate to
the timer value <code>0</code> the number of current occurrences for the timer value <code>1</code>,
we associate to the timer value <code>1</code> the number of current occurrences for
the timer value <code>2</code>, and so on, to model time passing. However, there are
two special cases due to the fact that every seven days a fish creates
another fish. The number of fish whose timer value is <code>6</code> is the current
number of fish whose timer value is <code>7</code> <em>plus</em> the number of fish whose
timer value is <code>0</code> (those fish created a new fish, and they will create
another fish in <code>6</code> days). Also, the number of fish whose timer value is <code>8</code>
is the number of fish that have been created during this turn, that is the
current number of fish whose timer value is <code>0</code>. This leaves us with the
following implementation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def tick(population: Map[Int, BigInt]): Map[Int, BigInt] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def countPopulation(daysLeft: Int): BigInt = population.getOrElse(daysLeft, BigInt(0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0 -&gt; countPopulation(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 -&gt; countPopulation(2),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2 -&gt; countPopulation(3),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3 -&gt; countPopulation(4),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4 -&gt; countPopulation(5),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5 -&gt; countPopulation(6),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6 -&gt; (countPopulation(7) + countPopulation(0)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    7 -&gt; countPopulation(8),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    8 -&gt; countPopulation(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The last missing piece to answer the challenge is to run the simulation for
a given number of days, and to compute the number of fish at the end of the
simulation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def simulate(days: Int, initialPopulation: Map[Int, BigInt]): BigInt =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (1 to days)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .foldLeft(initialPopulation)((population, _) =&gt; tick(population))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .sum</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The method <code>simulate</code> is very similar to the one I wrote for part 1. The
only difference is how it computes the number of fish from the model. It
achieves this by summing the groups of fish: the method <code>values</code> returns a
collection of groups of fish (each containing the number of fish in that
group), finally the method <code>sum</code> sums up the groups.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="final-code-for-part-2">Final code for part 2<a aria-hidden="true" class="hash-link" href="#final-code-for-part-2" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// &quot;How many lanternfish would there be after 256 days?&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def part2(input: String): BigInt =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  simulate(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    days = 256,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Fish.parseSeveral(input).groupMapReduce(_.timer)(_ =&gt; BigInt(1))(_ + _)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def simulate(days: Int, initialPopulation: Map[Int, BigInt]): BigInt =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (1 to days)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .foldLeft(initialPopulation)((population, _) =&gt; tick(population))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def tick(population: Map[Int, BigInt]): Map[Int, BigInt] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def countPopulation(daysLeft: Int): BigInt = population.getOrElse(daysLeft, BigInt(0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0 -&gt; countPopulation(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 -&gt; countPopulation(2),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2 -&gt; countPopulation(3),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3 -&gt; countPopulation(4),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4 -&gt; countPopulation(5),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5 -&gt; countPopulation(6),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6 -&gt; (countPopulation(7) + countPopulation(0)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    7 -&gt; countPopulation(8),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    8 -&gt; countPopulation(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div id="day6-part2"></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="run-it-locally">Run it locally<a aria-hidden="true" class="hash-link" href="#run-it-locally" title="Direct link to heading">​</a></h2><p>You can get this solution locally by cloning the <a href="https://github.com/scalacenter/scala-advent-of-code" target="_blank" rel="noopener noreferrer">scalacenter/scala-advent-of-code</a> repository.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/scalacenter/scala-advent-of-code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd advent-of-code</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can run it with <a href="https://scala-cli.virtuslab.org/" target="_blank" rel="noopener noreferrer">scala-cli</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ scala-cli src -M day6.part1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The solution is 345793</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ scala-cli src -M day6.part2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The solution is 1572643095893</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can replace the content of the <code>input/day6</code> file with your own input from <a href="https://adventofcode.com/2021/day/6" target="_blank" rel="noopener noreferrer">adventofcode.com</a> to get your own solution.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="solutions-from-the-community">Solutions from the community<a aria-hidden="true" class="hash-link" href="#solutions-from-the-community" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/tOverney/AdventOfCode2021/blob/main/src/main/scala/ch/overney/aoc/day6/" target="_blank" rel="noopener noreferrer">Solution</a> of <a href="https://github.com/tOverney" target="_blank" rel="noopener noreferrer">@tOverney</a>.</li><li><a href="https://github.com/FlorianCassayre/AdventOfCode-2021/blob/master/src/main/scala/adventofcode/solutions/Day06.scala" target="_blank" rel="noopener noreferrer">Solution</a> of <a href="https://github.com/FlorianCassayre" target="_blank" rel="noopener noreferrer">@FlorianCassayre</a>.</li><li><a href="https://github.com/Jannyboy11/AdventOfCode2021/blob/main/src/main/scala/day06/Day06.scala" target="_blank" rel="noopener noreferrer">Solution</a> of <a href="https://twitter.com/JanBoerman95" target="_blank" rel="noopener noreferrer">Jan Boerman</a>.</li></ul><p>Share your solution to the Scala community by editing this page.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/scalacenter/scala-advent-of-code/edit/website/docs/puzzles/day6.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/scala-advent-of-code/puzzles/day5"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Day 5: Hydrothermal Venture</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/scala-advent-of-code/puzzles/day7"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Day 7: The Treachery of Whales<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#puzzle-description" class="table-of-contents__link toc-highlight">Puzzle description</a></li><li><a href="#solution-of-part-1" class="table-of-contents__link toc-highlight">Solution of Part 1</a><ul><li><a href="#final-code-for-part-1" class="table-of-contents__link toc-highlight">Final code for Part 1</a></li></ul></li><li><a href="#first-attempt-for-part-2" class="table-of-contents__link toc-highlight">First attempt for Part 2</a></li><li><a href="#final-code-for-part-2" class="table-of-contents__link toc-highlight">Final code for part 2</a></li><li><a href="#run-it-locally" class="table-of-contents__link toc-highlight">Run it locally</a></li><li><a href="#solutions-from-the-community" class="table-of-contents__link toc-highlight">Solutions from the community</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/introduction">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/setup">Setup</a></li><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/puzzles/day1">Puzzles</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/channels/632150470000902164/913451015246868530" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/scala_lang" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://scala.epfl.ch/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scala Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/scalacenter" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Scala Center, Built with Docusaurus.</div></div></div></footer></div>
<script src="/scala-advent-of-code/assets/js/runtime~main.c7f5ced4.js"></script>
<script src="/scala-advent-of-code/assets/js/main.de35b7e5.js"></script>
</body>
</html>