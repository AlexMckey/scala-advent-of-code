<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous">
<script src="https://plausible.scala-lang.org/js/script.js" defer="defer" async data-domain="scalacenter.github.io"></script><title data-react-helmet="true">Day 14: Extended Polymerization | Scala Center Advent of Code</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://scalacenter.github.io//scala-advent-of-code/puzzles/day14"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Day 14: Extended Polymerization | Scala Center Advent of Code"><meta data-react-helmet="true" name="description" content="by @sjrd"><meta data-react-helmet="true" property="og:description" content="by @sjrd"><link data-react-helmet="true" rel="shortcut icon" href="/scala-advent-of-code/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day14"><link data-react-helmet="true" rel="alternate" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day14" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://scalacenter.github.io//scala-advent-of-code/puzzles/day14" hreflang="x-default"><link rel="stylesheet" href="/scala-advent-of-code/assets/css/styles.16a73e1b.css">
<link rel="preload" href="/scala-advent-of-code/assets/js/runtime~main.af9b7c7f.js" as="script">
<link rel="preload" href="/scala-advent-of-code/assets/js/main.0adb1467.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/scala-advent-of-code/"><div class="navbar__logo"><img src="/scala-advent-of-code/img/scala-tree.png" alt="Scala Center" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/scala-advent-of-code/img/scala-tree.png" alt="Scala Center" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Scala Advent of Code</b></a><a class="navbar__item navbar__link navbar__link--active" href="/scala-advent-of-code/introduction">Introduction</a><a class="navbar__item navbar__link navbar__link--active" href="/scala-advent-of-code/setup">Setup</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Puzzles</a><ul class="dropdown__menu"><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day1">Day 1</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day2">Day 2</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day3">Day 3</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day4">Day 4</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day5">Day 5</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day6">Day 6</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day7">Day 7</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day8">Day 8</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day9">Day 9</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day10">Day 10</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day11">Day 11</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day12">Day 12</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day13">Day 13</a></li><li><a aria-current="page" class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day14">Day 14</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day15">Day 15</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day16">Day 16</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day17">Day 17</a></li><li><a class="dropdown__link navbar__link--active" href="/scala-advent-of-code/puzzles/day20">Day 20</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scalacenter/scala-advent-of-code" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/scala-advent-of-code/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/scala-advent-of-code/setup">Setup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Puzzles</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day1">Day 1: Sonar Sweep</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day2">Day 2: Dive!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day3">Day 3: Binary Diagnostic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day4">Day 4: Giant Squid</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day5">Day 5: Hydrothermal Venture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day6">Day 6: Lanternfish</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day7">Day 7: The Treachery of Whales</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day8">Day 8: Seven Segment Search</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day9">Day 9: Smoke Basin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day10">Day 10: Syntax Scoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day11">Day 11: Dumbo Octopus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day12">Day 12: Passage Pathing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day13">Day 13: Transparent Origami</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/scala-advent-of-code/puzzles/day14">Day 14: Extended Polymerization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day15">Day 15: Chiton</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day16">Day 16: Packet Decoder</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day17">Day 17: Trick Shot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day18">Day 18: Snailfish</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day19">Day 19: Beacon Scanner</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scala-advent-of-code/puzzles/day20">Day 20: Trench Map</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Day 14: Extended Polymerization</h1></header><p>by @sjrd</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="puzzle-description">Puzzle description<a aria-hidden="true" class="hash-link" href="#puzzle-description" title="Direct link to heading">â€‹</a></h2><p><a href="https://adventofcode.com/2021/day/14" target="_blank" rel="noopener noreferrer">https://adventofcode.com/2021/day/14</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="modeling-and-parsing-the-input">Modeling and parsing the input<a aria-hidden="true" class="hash-link" href="#modeling-and-parsing-the-input" title="Direct link to heading">â€‹</a></h2><p>Today, the input is an initial polymer and a list of insertion rules.
The insertion rules map a pair of characters to another character to insert.
We model them as</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type Polymer = List[Char]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type CharPair = (Char, Char)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type InsertionRules = Map[CharPair, Char]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and we can parse the input with</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def parseInput(input: String): (Polymer, InsertionRules) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val sections = input.split(&quot;\n\n&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val initialPolymer = sections(0).toList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val insertionRules = sections(1).linesIterator.map(parseRule).toMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (initialPolymer, insertionRules)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you have been following our previous posts, the above is nothing out of the ordinary.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="from-frequencies-to-the-end-result">From frequencies to the end result<a aria-hidden="true" class="hash-link" href="#from-frequencies-to-the-end-result" title="Direct link to heading">â€‹</a></h2><p>At the end of the day, we will need a count of all the frequencies of all characters.
We model it as a map from char to long:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type Frequencies = Map[Char, Long]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Assuming we have computed the frequencies in the final polymer, the result will be the difference between the maximum frequency and the minimum frequency.
We compute that as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val frequencies: Frequencies = ???</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val max = frequencies.values.max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val min = frequencies.values.min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max - min</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="applying-the-insertion-rules">Applying the insertion rules<a aria-hidden="true" class="hash-link" href="#applying-the-insertion-rules" title="Direct link to heading">â€‹</a></h2><p>We solve part 1 by directly applying the instructions.
We start with a function to execute one step of replacements:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def applyRules(polymer: Polymer, rules: InsertionRules): Polymer =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val pairs = polymer.zip(polymer.tail)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val insertionsAndSeconds: List[List[Char]] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for pair @ (first, second) &lt;- pairs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      yield rules(pair) :: second :: Nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  polymer.head :: insertionsAndSeconds.flatten</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>polymer.zip(polymer.tail)</code> expression returns a list of pairs of adjacent characters.
From the example</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">NNCB</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>we will have</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pairs = List((&#x27;N&#x27;, &#x27;N&#x27;), (&#x27;N&#x27;, &#x27;C&#x27;), (&#x27;C&#x27;, &#x27;B&#x27;))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, we map each such pair to the corresponding inserted char, followed by the second character of the pair.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">insertionsAndSeconds = List(List(&#x27;C&#x27;, &#x27;N&#x27;), List(&#x27;B&#x27;, &#x27;C&#x27;), List(&#x27;H&#x27;, &#x27;B&#x27;))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally, we concatenate all those intermediate lists with <code>flatten</code>, and add the initial character at the front:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">result = &#x27;N&#x27; :: List(&#x27;C&#x27;, &#x27;N&#x27;) ::: List(&#x27;B&#x27;, &#x27;C&#x27;) ::: List(&#x27;H&#x27;, &#x27;B&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       = List(&#x27;N&#x27;, &#x27;C&#x27;, &#x27;N&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;H&#x27;, &#x27;B&#x27;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>From the initial polymer, we repeatedly apply the rules 10 times to get the final polymer:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val (initialPolymer, insertionRules) = parseInput(input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val finalPolymer = (0 until 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .foldLeft(initialPolymer)((polymer, _) =&gt; applyRules(polymer, insertionRules))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and we compute the frequencies with</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val frequencies: Frequencies = finalPolymer.groupMapReduce(identity)(_ =&gt; 1L)(_ + _)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="solution-for-part-1">Solution for part 1<a aria-hidden="true" class="hash-link" href="#solution-for-part-1" title="Direct link to heading">â€‹</a></h2><p>This concludes part 1, whose entire code is:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type Polymer = List[Char]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type CharPair = (Char, Char)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type InsertionRules = Map[CharPair, Char]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Frequencies = Map[Char, Long]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def part1(input: String): Long =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (initialPolymer, insertionRules) = parseInput(input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val finalPolymer = (0 until 10).foldLeft(initialPolymer)((polymer, _) =&gt; applyRules(polymer, insertionRules))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val frequencies: Frequencies = finalPolymer.groupMapReduce(identity)(_ =&gt; 1L)(_ + _)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val max = frequencies.values.max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val min = frequencies.values.min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max - min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def parseInput(input: String): (Polymer, InsertionRules) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val sections = input.split(&quot;\n\n&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val initialPolymer = sections(0).toList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val insertionRules = sections(1).linesIterator.map(parseRule).toMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (initialPolymer, insertionRules)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def parseRule(line: String): (CharPair, Char) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  line match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case s&quot;$pairStr -&gt; $inserStr&quot; =&gt; (pairStr(0), pairStr(1)) -&gt; inserStr(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case _                        =&gt; throw new Exception(s&quot;Cannot parse &#x27;$line&#x27; as an insertion rule&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def applyRules(polymer: Polymer, rules: InsertionRules): Polymer =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val pairs = polymer.zip(polymer.tail)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val insertionsAndSeconds: List[List[Char]] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for pair @ (first, second) &lt;- pairs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      yield rules(pair) :: second :: Nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  polymer.head :: insertionsAndSeconds.flatten</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div id="day14-part1"></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="part-2">Part 2<a aria-hidden="true" class="hash-link" href="#part-2" title="Direct link to heading">â€‹</a></h2><p>The statement of part 2 says to follow the same logic, but with 40 iterations instead of 10 previously.
Unfortunately, it is not as simple as reusing the first implementation above.
The final polymer&#x27;s length would exceed 4G of characters, let alone the additional memory of the <code>List</code> and the processing time required to build it.
We need to compute the eventual frequencies <em>without</em> computing the <code>finalPolymer</code> at all.</p><p>Let us start by defining the abstract function <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>a</mi><mi>b</mi><mo>â‹¯</mo><mi>f</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(ab \cdots f, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span> as being the frequencies of all letters, <em>except the first one</em>, in the expansion of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mo>â‹¯</mo><mi>f</mi></mrow><annotation encoding="application/x-tex">ab \cdots f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span></span></span></span></span> after <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">n</span></span></span></span></span> steps.
We come up with this function definition based on mathematical intuition.
We can only justify that choice by showing hereafter that it allows us to solve our problem.</p><p>With the example insertion rules, and for the example string <code>NNCB</code>, we would have:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>S</mi><mo stretchy="false">(</mo><mtext>NNCB</mtext><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">{</mo><mtext>B</mtext><mo>â†’</mo><mn>1</mn><mo separator="true">,</mo><mtext>C</mtext><mo>â†’</mo><mn>1</mn><mo separator="true">,</mo><mtext>N</mtext><mo>â†’</mo><mn>1</mn><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>S</mi><mo stretchy="false">(</mo><mtext>NNCB</mtext><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>S</mi><mo stretchy="false">(</mo><mtext>NCNBCHB</mtext><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">{</mo><mtext>B</mtext><mo>â†’</mo><mn>2</mn><mo separator="true">,</mo><mtext>C</mtext><mo>â†’</mo><mn>2</mn><mo separator="true">,</mo><mtext>H</mtext><mo>â†’</mo><mn>1</mn><mo separator="true">,</mo><mtext>N</mtext><mo>â†’</mo><mn>1</mn><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} S(\text{NNCB}, 0) &amp; = \{ \text{B} \rightarrow 1, \text{C} \rightarrow 1, \text{N} \rightarrow 1 \} \\ S(\text{NNCB}, 1) &amp; = S(\text{NCNBCHB}, 0) \\ &amp; = \{ \text{B} \rightarrow 2, \text{C} \rightarrow 2, \text{H} \rightarrow 1, \text{N} \rightarrow 1 \} \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.500000000000002em;vertical-align:-2.000000000000001em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5000000000000004em"><span style="top:-4.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord text"><span class="mord">NNCB</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">0</span><span class="mclose">)</span></span></span><span style="top:-3.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord text"><span class="mord">NNCB</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-1.6599999999999993em"><span class="pstrut" style="height:3em"></span><span class="mord"></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.000000000000001em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5000000000000004em"><span style="top:-4.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mopen">{</span><span class="mord text"><span class="mord">B</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord text"><span class="mord">C</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord text"><span class="mord">N</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord">1</span><span class="mclose">}</span></span></span><span style="top:-3.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord text"><span class="mord">NCNBCHB</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">0</span><span class="mclose">)</span></span></span><span style="top:-1.6599999999999993em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mopen">{</span><span class="mord text"><span class="mord">B</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord text"><span class="mord">C</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord text"><span class="mord">H</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord text"><span class="mord">N</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord">1</span><span class="mclose">}</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.000000000000001em"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>Note that one <code>N</code> (the one at the beginning of the string) is excluded from the frequencies every time.</p><p>Frequencies are <em>multisets</em>: sets that can have multiple copies of the same element.
We can use the <em>sum</em> of multisets, noted with <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo></mrow><annotation encoding="application/x-tex">+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em"></span><span class="mord">+</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Î£</mi></mrow><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord">Î£</span></span></span></span></span>, which accumulates counts.</p><p>With the definitions above, we can proceed with solving our problem.</p><p>For any string longer than 2 chars, we have the following property:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub><msub><mi>x</mi><mn>3</mn></msub><mo>â‹¯</mo><msub><mi>x</mi><mi>p</mi></msub><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(x_1 x_2 x_3 \cdots x_p, n) = \Sigma_{i=1}^{p-1} (S(x_i x_{i+1}, n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.2088799999999997em;vertical-align:-0.276864em"></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9320159999999998em"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.180908em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.276864em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></div><p>In other words, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span></span></span></span></span> for a string is the <em>sum</em> (a multiset sum) of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span></span></span></span></span> for all the adjacent pairs in the string, with the same number of iterations <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">n</span></span></span></span></span>.
That is because each initial pair of letters (such as <code>NN</code>, <code>NC</code> and <code>CB</code>) expands independently of the others.
Each initial char is counted exactly once in the final frequencies because it is counted as part of the expansion of the pair on its left, and not the expansion of the pair on its right (we always exclude the first char).</p><p>As a particular case of the above, for a string of 3 chars <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>z</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xzy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>, we have</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mi>y</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mi>S</mi><mo stretchy="false">(</mo><mi>z</mi><mi>y</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(xzy, n) = S(xz, n) + S(zy, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></div><p>For strings of length 2, we have two cases: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">n = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">n &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span></span></span></span></span>.</p><p>Base case: a pair <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>, and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">n = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span></span></span></span></span></p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mi>y</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">{</mo><mi>y</mi><mo>â†’</mo><mn>1</mn><mo stretchy="false">}</mo><mtext>Â forÂ allÂ </mtext><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mtext>Â (byÂ definition)</mtext></mrow><annotation encoding="application/x-tex">S(xy, 0) = \{ y \rightarrow 1 \} \text{ for all } x, y \text{ (by definition)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">}</span><span class="mord text"><span class="mord">Â forÂ allÂ </span></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mord text"><span class="mord">Â (byÂ definition)</span></span></span></span></span></span></div><p>Inductive case: a pair <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>, and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">n &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span></span></span></span></span></p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mi>y</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mi>y</mi><mo separator="true">,</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mrow><mtext>Â whereÂ </mtext><mstyle scriptlevel="0" displaystyle="false"><mi>z</mi></mstyle><mtext>Â isÂ theÂ insertionÂ charÂ forÂ theÂ pairÂ </mtext><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi><mi>y</mi></mstyle><mtext>Â (byÂ definition)</mtext></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mo separator="true">,</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mi>S</mi><mo stretchy="false">(</mo><mi>z</mi><mi>y</mi><mo separator="true">,</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mtext>Â â€“Â theÂ particularÂ caseÂ ofÂ 3Â charsÂ above</mtext></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} S(xy, n) &amp; = S(xzy, n-1) \text{ where $z$ is the insertion char for the pair $xy$ (by definition)} \\ &amp; = S(xz, n-1) + S(zy, n-1) \text{ -- the particular case of 3 chars above} \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000000000000004em;vertical-align:-1.2500000000000002em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em"><span style="top:-3.91em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em"><span style="top:-3.91em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord text"><span class="mord">Â whereÂ </span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mord">Â isÂ theÂ insertionÂ charÂ forÂ theÂ pairÂ </span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mord">Â (byÂ definition)</span></span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord text"><span class="mord">Â â€“Â theÂ particularÂ caseÂ ofÂ 3Â charsÂ above</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>This means that the frequencies of letters after <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span> has produced its final polymer are equal to the sum of frequencies that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>z</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xzy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span> produces after 1 fewer steps.</p><p>Now that we have an inductive definition of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mi>y</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(xy, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span> for all pairs, we can write an iterative algorithm that computes that for all possible pairs <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>, for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>âˆˆ</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>40</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">n \in \lbrack 0, 40 \rbrack</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">4</span><span class="mord">0</span><span class="mclose">]</span></span></span></span></span> :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// S : (charPair, n) -&gt; frequencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val S = mutable.Map.empty[(CharPair, Int), Frequencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Base case: S(xy, 0) = {y -&gt; 1} for all x, y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (pair @ (first, second), insert) &lt;- insertionRules do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  S((pair, 0)) = Map(second -&gt; 1L)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Recursive case S(xy, n) = S(xz, n - 1) + S(zy, n - 1) with z = insertionRules(xy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for n &lt;- 1 to 40 do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (pair, insert) &lt;- insertionRules do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val (x, y) = pair</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val z = insertionRules(pair)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    S((pair, n)) = addFrequencies(S((x, z), n - 1), S((z, y), n - 1))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>where <code>addFrequencies</code> implements the multiset sum of two bags of frequencies:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def addFrequencies(a: Frequencies, b: Frequencies): Frequencies =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b.foldLeft(a) { case (prev, (char, frequency)) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prev + (char -&gt; (prev.getOrElse(char, 0L) + frequency))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Using the initial property of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span></span></span></span></span> for strings longer than 2 chars, we can compute <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mtext>initialPolymer</mtext><mo separator="true">,</mo><mn>40</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(\text{initialPolymer}, 40)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord text"><span class="mord">initialPolymer</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">4</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span> from the compute <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mi>y</mi><mo separator="true">,</mo><mn>40</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(xy, 40)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">4</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// S(polymer, 40) = âˆ‘(S(pair, 40))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val pairsInPolymer = initialPolymer.zip(initialPolymer.tail)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val polymerS = (for pair &lt;- pairsInPolymer yield S(pair, 40)).reduce(addFrequencies)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And finally, we add the very first character, once, to compute the full frequencies:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// We have to add the very first char to get all the frequencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val frequencies = addFrequencies(polymerS, Map(initialPolymer.head -&gt; 1L))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After which we have all the pieces for part 2.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="final-code-for-part-2">Final code for part 2<a aria-hidden="true" class="hash-link" href="#final-code-for-part-2" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">def part2(input: String): Long =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (initialPolymer, insertionRules) = parseInput(input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // S : (charPair, n) -&gt; frequencies of everything but the first char after n iterations from charPair</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val S = mutable.Map.empty[(CharPair, Int), Frequencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Base case: S(xy, 0) = {y -&gt; 1} for all x, y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (pair @ (first, second), insert) &lt;- insertionRules do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    S((pair, 0)) = Map(second -&gt; 1L)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Recursive case S(xy, n) = S(xz, n - 1) + S(zy, n - 1) with z = insertionRules(xy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for n &lt;- 1 to 40 do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (pair, insert) &lt;- insertionRules do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val (x, y) = pair</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val z = insertionRules(pair)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      S((pair, n)) = addFrequencies(S((x, z), n - 1), S((z, y), n - 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // S(polymer, 40) = âˆ‘(S(pair, 40))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val pairsInPolymer = initialPolymer.zip(initialPolymer.tail)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val polymerS = (for pair &lt;- pairsInPolymer yield S(pair, 40)).reduce(addFrequencies)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // We have to add the very first char to get all the frequencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val frequencies = addFrequencies(polymerS, Map(initialPolymer.head -&gt; 1L))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Finally, we can finish the computation as in part 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val max = frequencies.values.max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val min = frequencies.values.min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max - min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def addFrequencies(a: Frequencies, b: Frequencies): Frequencies =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b.foldLeft(a) { case (prev, (char, frequency)) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prev + (char -&gt; (prev.getOrElse(char, 0L) + frequency))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div id="day14-part2"></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="run-it-locally">Run it locally<a aria-hidden="true" class="hash-link" href="#run-it-locally" title="Direct link to heading">â€‹</a></h2><p>You can get this solution locally by cloning the <a href="https://github.com/scalacenter/scala-advent-of-code" target="_blank" rel="noopener noreferrer">scalacenter/scala-advent-of-code</a> repository.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/scalacenter/scala-advent-of-code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd scala-advent-of-code</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can run it with <a href="https://scala-cli.virtuslab.org/" target="_blank" rel="noopener noreferrer">scala-cli</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ scala-cli src -M day14.part1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The answer is: 3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ scala-cli src -M day14.part2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The answer is: 3760312702877</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can replace the content of the <code>input/day14</code> file with your own input from <a href="https://adventofcode.com/2021/day/14" target="_blank" rel="noopener noreferrer">adventofcode.com</a> to get your own solution.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="solutions-from-the-community">Solutions from the community<a aria-hidden="true" class="hash-link" href="#solutions-from-the-community" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://github.com/Jannyboy11/AdventOfCode2021/blob/main/src/main/scala/day14/Day14.scala" target="_blank" rel="noopener noreferrer">Solution</a> of <a href="https://twitter.com/JanBoerman95" target="_blank" rel="noopener noreferrer">Jan Boerman</a>.</li></ul><p>Share your solution to the Scala community by editing this page.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/scalacenter/scala-advent-of-code/edit/website/docs/puzzles/day14.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/scala-advent-of-code/puzzles/day13"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Day 13: Transparent Origami</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/scala-advent-of-code/puzzles/day15"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Day 15: Chiton<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#puzzle-description" class="table-of-contents__link toc-highlight">Puzzle description</a></li><li><a href="#modeling-and-parsing-the-input" class="table-of-contents__link toc-highlight">Modeling and parsing the input</a></li><li><a href="#from-frequencies-to-the-end-result" class="table-of-contents__link toc-highlight">From frequencies to the end result</a></li><li><a href="#applying-the-insertion-rules" class="table-of-contents__link toc-highlight">Applying the insertion rules</a></li><li><a href="#solution-for-part-1" class="table-of-contents__link toc-highlight">Solution for part 1</a></li><li><a href="#part-2" class="table-of-contents__link toc-highlight">Part 2</a></li><li><a href="#final-code-for-part-2" class="table-of-contents__link toc-highlight">Final code for part 2</a></li><li><a href="#run-it-locally" class="table-of-contents__link toc-highlight">Run it locally</a></li><li><a href="#solutions-from-the-community" class="table-of-contents__link toc-highlight">Solutions from the community</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/introduction">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/setup">Setup</a></li><li class="footer__item"><a class="footer__link-item" href="/scala-advent-of-code/puzzles/day1">Puzzles</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/channels/632150470000902164/913451015246868530" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/scala_lang" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://scala.epfl.ch/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scala Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/scalacenter" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Scala Center, Built with Docusaurus.</div></div></div></footer></div>
<script src="/scala-advent-of-code/assets/js/runtime~main.af9b7c7f.js"></script>
<script src="/scala-advent-of-code/assets/js/main.0adb1467.js"></script>
</body>
</html>